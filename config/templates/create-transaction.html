{% extends 'base.html' %}

{% block title %}Add Category{% endblock %}
{% block onload %}requireAuth();{% endblock %}

{% block content %}
<h2>Add Category</h2>

<form id="categoryForm">
    <input id="name" placeholder="Category Name" required>
    <button type="submit">Add Category</button>
    <p id="error" style="color:red;"></p>
</form>
{% endblock %}

<script>
document.getElementById("categoryForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const res = await fetch("/api/categories/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${getToken()}`
        },
        body: JSON.stringify({
            name: document.getElementById("name").value
        })
    });

    const data = await res.json();
    if (res.ok) {
        alert("Category added!");
        window.location.href = "{% url 'categories' %}";
    } else {
        document.getElementById("error").innerText = data.detail || "Error adding category";
    }
});
</script>
